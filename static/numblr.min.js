var Numblr=function(){"use strict";var t;const e=globalThis.trustedTypes,i=e?e.createPolicy("lit-html",{createHTML:t=>t}):void 0,s=`lit$${(Math.random()+"").slice(9)}$`,n="?"+s,o=`<${n}>`,r=document,l=(t="")=>r.createComment(t),a=t=>null===t||"object"!=typeof t&&"function"!=typeof t,h=Array.isArray,c=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,d=/-->/g,u=/>/g,v=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,m=/'/g,$=/"/g,f=/^(?:script|style|textarea)$/i,p=(()=>(t,...e)=>({_$litType$:1,strings:t,values:e}))(),g=Symbol.for("lit-noChange"),A=Symbol.for("lit-nothing"),y=new WeakMap,_=r.createTreeWalker(r,129,null,!1),b=(t,e)=>{const n=t.length-1,r=[];let l,a=2===e?"<svg>":"",h=c;for(let e=0;e<n;e++){const i=t[e];let n,p,g=-1,A=0;for(;A<i.length&&(h.lastIndex=A,p=h.exec(i),null!==p);)A=h.lastIndex,h===c?"!--"===p[1]?h=d:void 0!==p[1]?h=u:void 0!==p[2]?(f.test(p[2])&&(l=RegExp("</"+p[2],"g")),h=v):void 0!==p[3]&&(h=v):h===v?">"===p[0]?(h=null!=l?l:c,g=-1):void 0===p[1]?g=-2:(g=h.lastIndex-p[2].length,n=p[1],h=void 0===p[3]?v:'"'===p[3]?$:m):h===$||h===m?h=v:h===d||h===u?h=c:(h=v,l=void 0);const y=h===v&&t[e+1].startsWith("/>")?" ":"";a+=h===c?i+o:g>=0?(r.push(n),i.slice(0,g)+"$lit$"+i.slice(g)+s+y):i+s+(-2===g?(r.push(void 0),e):y)}const p=a+(t[n]||"<?>")+(2===e?"</svg>":"");return[void 0!==i?i.createHTML(p):p,r]};class w{constructor({strings:t,_$litType$:i},o){let r;this.parts=[];let a=0,h=0;const c=t.length-1,d=this.parts,[u,v]=b(t,i);if(this.el=w.createElement(u,o),_.currentNode=this.el.content,2===i){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(r=_.nextNode())&&d.length<c;){if(1===r.nodeType){if(r.hasAttributes()){const t=[];for(const e of r.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(s)){const i=v[h++];if(t.push(e),void 0!==i){const t=r.getAttribute(i.toLowerCase()+"$lit$").split(s),e=/([.?@])?(.*)/.exec(i);d.push({type:1,index:a,name:e[2],strings:t,ctor:"."===e[1]?H:"?"===e[1]?C:"@"===e[1]?E:N})}else d.push({type:6,index:a})}for(const e of t)r.removeAttribute(e)}if(f.test(r.tagName)){const t=r.textContent.split(s),i=t.length-1;if(i>0){r.textContent=e?e.emptyScript:"";for(let e=0;e<i;e++)r.append(t[e],l()),_.nextNode(),d.push({type:2,index:++a});r.append(t[i],l())}}}else if(8===r.nodeType)if(r.data===n)d.push({type:2,index:a});else{let t=-1;for(;-1!==(t=r.data.indexOf(s,t+1));)d.push({type:7,index:a}),t+=s.length-1}a++}}static createElement(t,e){const i=r.createElement("template");return i.innerHTML=t,i}}function T(t,e,i=t,s){var n,o,r,l;if(e===g)return e;let h=void 0!==s?null===(n=i._$Cl)||void 0===n?void 0:n[s]:i._$Cu;const c=a(e)?void 0:e._$litDirective$;return(null==h?void 0:h.constructor)!==c&&(null===(o=null==h?void 0:h._$AO)||void 0===o||o.call(h,!1),void 0===c?h=void 0:(h=new c(t),h._$AT(t,i,s)),void 0!==s?(null!==(r=(l=i)._$Cl)&&void 0!==r?r:l._$Cl=[])[s]=h:i._$Cu=h),void 0!==h&&(e=T(t,h._$AS(t,e.values),h,s)),e}class x{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:i},parts:s}=this._$AD,n=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:r).importNode(i,!0);_.currentNode=n;let o=_.nextNode(),l=0,a=0,h=s[0];for(;void 0!==h;){if(l===h.index){let e;2===h.type?e=new S(o,o.nextSibling,this,t):1===h.type?e=new h.ctor(o,h.name,h.strings,this,t):6===h.type&&(e=new k(o,this,t)),this.v.push(e),h=s[++a]}l!==(null==h?void 0:h.index)&&(o=_.nextNode(),l++)}return n}m(t){let e=0;for(const i of this.v)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class S{constructor(t,e,i,s){var n;this.type=2,this._$AH=A,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=s,this._$Cg=null===(n=null==s?void 0:s.isConnected)||void 0===n||n}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cg}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=T(this,t,e),a(t)?t===A||null==t||""===t?(this._$AH!==A&&this._$AR(),this._$AH=A):t!==this._$AH&&t!==g&&this.$(t):void 0!==t._$litType$?this.T(t):void 0!==t.nodeType?this.S(t):(t=>{var e;return h(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.M(t):this.$(t)}A(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}S(t){this._$AH!==t&&(this._$AR(),this._$AH=this.A(t))}$(t){this._$AH!==A&&a(this._$AH)?this._$AA.nextSibling.data=t:this.S(r.createTextNode(t)),this._$AH=t}T(t){var e;const{values:i,_$litType$:s}=t,n="number"==typeof s?this._$AC(t):(void 0===s.el&&(s.el=w.createElement(s.h,this.options)),s);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===n)this._$AH.m(i);else{const t=new x(n,this),e=t.p(this.options);t.m(i),this.S(e),this._$AH=t}}_$AC(t){let e=y.get(t.strings);return void 0===e&&y.set(t.strings,e=new w(t)),e}M(t){h(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,s=0;for(const n of t)s===e.length?e.push(i=new S(this.A(l()),this.A(l()),this,this.options)):i=e[s],i._$AI(n),s++;s<e.length&&(this._$AR(i&&i._$AB.nextSibling,s),e.length=s)}_$AR(t=this._$AA.nextSibling,e){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cg=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class N{constructor(t,e,i,s,n){this.type=1,this._$AH=A,this._$AN=void 0,this.element=t,this.name=e,this._$AM=s,this.options=n,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=A}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,s){const n=this.strings;let o=!1;if(void 0===n)t=T(this,t,e,0),o=!a(t)||t!==this._$AH&&t!==g,o&&(this._$AH=t);else{const s=t;let r,l;for(t=n[0],r=0;r<n.length-1;r++)l=T(this,s[i+r],e,r),l===g&&(l=this._$AH[r]),o||(o=!a(l)||l!==this._$AH[r]),l===A?t=A:t!==A&&(t+=(null!=l?l:"")+n[r+1]),this._$AH[r]=l}o&&!s&&this.k(t)}k(t){t===A?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class H extends N{constructor(){super(...arguments),this.type=3}k(t){this.element[this.name]=t===A?void 0:t}}class C extends N{constructor(){super(...arguments),this.type=4}k(t){t&&t!==A?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class E extends N{constructor(t,e,i,s,n){super(t,e,i,s,n),this.type=5}_$AI(t,e=this){var i;if((t=null!==(i=T(this,t,e,0))&&void 0!==i?i:A)===g)return;const s=this._$AH,n=t===A&&s!==A||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,o=t!==A&&(s===A||n);n&&this.element.removeEventListener(this.name,this,s),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==i?i:this.element,t):this._$AH.handleEvent(t)}}class k{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){T(this,t)}}const L=window.litHtmlPolyfillSupport;null==L||L(w,S),(null!==(t=globalThis.litHtmlVersions)&&void 0!==t?t:globalThis.litHtmlVersions=[]).push("2.0.1");var I=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D="object"==typeof self&&self&&self.Object===Object&&self,O="object"==typeof M&&M&&M.Object===Object&&M||D||Function("return this")(),j=function(){return O.Date.now()},U=/\s/,R=/^\s+/,q=function(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&U.test(t.charAt(e)););return e}(t)+1).replace(R,""):t},P=O.Symbol,B=Object.prototype,W=B.hasOwnProperty,K=B.toString,z=P?P.toStringTag:void 0,G=Object.prototype.toString,Z=P?P.toStringTag:void 0,V=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Z&&Z in Object(t)?function(t){var e=W.call(t,z),i=t[z];try{t[z]=void 0;var s=!0}catch(t){}var n=K.call(t);return s&&(e?t[z]=i:delete t[z]),n}(t):function(t){return G.call(t)}(t)},F=/^[-+]0x[0-9a-f]+$/i,J=/^0b[01]+$/i,Y=/^0o[0-7]+$/i,Q=parseInt,X=function(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==V(t)}(t))return NaN;if(I(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=I(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=q(t);var i=J.test(t);return i||Y.test(t)?Q(t.slice(2),i?2:8):F.test(t)?NaN:+t},tt=Math.max,et=Math.min;class it{constructor(){this.$overlay=Overlay,this.$end=End,this.$cols=[Col0,Col1,Col2],this.$timer={$:Timer,toggle:Timer.querySelector(".toggle"),plus:Timer.querySelector(".plus"),minus:Timer.querySelector(".minus"),secs:Timer.querySelector(".secs")},this.onScroll=function(t,e,i){var s,n,o,r,l,a,h=0,c=!1,d=!1,u=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){var i=s,o=n;return s=n=void 0,h=e,r=t.apply(o,i)}function m(t){return h=t,l=setTimeout(f,e),c?v(t):r}function $(t){var i=t-a;return void 0===a||i>=e||i<0||d&&t-h>=o}function f(){var t=j();if($(t))return p(t);l=setTimeout(f,function(t){var i=e-(t-a);return d?et(i,o-(t-h)):i}(t))}function p(t){return l=void 0,u&&s?v(t):(s=n=void 0,r)}function g(){var t=j(),i=$(t);if(s=arguments,n=this,a=t,i){if(void 0===l)return m(a);if(d)return clearTimeout(l),l=setTimeout(f,e),v(a)}return void 0===l&&(l=setTimeout(f,e)),r}return e=X(e)||0,I(i)&&(c=!!i.leading,o=(d="maxWait"in i)?tt(X(i.maxWait)||0,e):o,u="trailing"in i?!!i.trailing:u),g.cancel=function(){void 0!==l&&clearTimeout(l),h=0,s=a=n=l=void 0},g.flush=function(){return void 0===l?r:p(j())},g}((()=>{document.body.clientHeight-(window.scrollY+window.innerHeight)<200&&this.loadNext()}),300),this.onClick=t=>{if(!t.target)return;const e=t.target;if("A"!==e.tagName&&(t.preventDefault(),"IMG"===e.tagName)){const i=e;t.metaKey||t.ctrlKey?fetch("/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:i.dataset.orig||i.src})}).then((t=>t.json())).then((()=>{e.classList.add("success"),setTimeout((()=>{e.classList.remove("success")}),500)})).catch(alert):t.altKey?this.downloadDirect(i.dataset.orig||i.src):("big"==e.classList.toString()?this.select():this.select(i),this.$overlay.style.display="block"===this.$overlay.style.display?"none":"block","none"===this.$overlay.style.display&&this.timer&&clearInterval(this.timer))}},this.toggleTimer=()=>{this.setTimer(this.timer?0:this.state.timerSec||2e3)},this.onKeydown=t=>{const e=document.querySelector(".big");" "===t.key&&e&&(t.preventDefault(),this.toggleTimer()),"ArrowRight"===t.key&&e&&this.showDir(1),"ArrowLeft"===t.key&&e&&this.showDir(-1),"ArrowUp"===t.key&&e&&this.setTimer(Math.min(1e5,this.state.timerSec+1e3)),"ArrowDown"===t.key&&e&&this.setTimer(Math.max(1e3,this.state.timerSec-1e3)),"123450".includes(t.key)&&(this.timer&&clearInterval(this.timer),this.setTimer(1e3*Number(t.key))),"Escape"===t.key&&(this.timer&&clearInterval(this.timer),this.$overlay.style.display="none",this.select())},this.timer=void 0,this.state={offset:Number(window.location.hash.slice(1)||0),nextCol:1,imgIdx:0,colh:[0,0,0],zoom:!1,timerSec:2e3},this.start()}start(){var t,e;this.loadNext(),this.$end.addEventListener("click",(()=>{this.loadNext()})),window.addEventListener("scroll",this.onScroll),document.addEventListener("keydown",this.onKeydown),document.addEventListener("click",this.onClick),null===(t=this.$overlay.querySelector(".next"))||void 0===t||t.addEventListener("click",(()=>{this.showDir(1)})),null===(e=this.$overlay.querySelector(".prev"))||void 0===e||e.addEventListener("click",(()=>{this.showDir(-1)})),this.$timer.toggle.onclick=this.toggleTimer,this.$timer.plus.onclick=()=>{this.setTimer(Math.min(1e5,this.state.timerSec+1e3))},this.$timer.minus.onclick=()=>{this.setTimer(Math.max(1e3,this.state.timerSec-1e3))}}get minColIdx(){const[t,e,i]=this.state.colh;if(t+e+i===0)return(10*Math.random()>>0)%3;const s=Math.min(...this.state.colh),n=this.state.colh.indexOf(s);if(-1===n)throw new Error("Invalud case @TODO");return n}downloadDirect(t){const e=t.split("/").pop();fetch(t,{method:"GET"}).then((t=>t.blob())).then((t=>{const i=window.URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),s.remove()}))}setTimer(t){this.timer&&clearInterval(this.timer),this.state.timerSec=t||2e3,this.timer=t?setInterval((()=>this.showDir(1)),this.state.timerSec):void 0;const e=this.$timer.toggle.querySelector(".fas");e&&(this.timer?(e.classList.add("fa-pause"),e.classList.remove("fa-play")):(e.classList.remove("fa-pause"),e.classList.add("fa-play")),this.recordTimer())}async showDir(t){var e;const i=document.querySelector(".big");if(!i)return;const s=Number(null===(e=i.dataset)||void 0===e?void 0:e.idx)+t;this.state.imgIdx-s<5&&await this.loadNext();const n=document.querySelector(`[data-idx="${s}"]`);this.select(n)}renderPost(t,e,i){const s=[];return t.photos.forEach((n=>{s.push(p`
                <figure class="fig">
                    <img
                        src="${n.thumb}"
                        data-orig="${n.hres}"
                        data-col="${i} "
                        data-post="${t.idx}"
                        data-idx="${this.state.imgIdx}"
                    />
                    <div class="controls">
                        <button class="save" type="button" data-src="${n.hres}" @click=${e}>
                            <i class="fas fa-save fa"></i>
                        </button>
                    </div>
                </figure>
            `),this.state.imgIdx+=1})),p`
            <div class="post-imgs">${s}</div>
            <div class="post-caption">
                <div class="nowrap">
                    <a href="${t.url}/"><i class="fas fa-link"></i></a>
                    &nbsp;
                    <div ?hidden=${!t.rebloggedRoot}>
                        <i class="fas fa-user"></i>&nbsp;<a href="/folder/${t.rebloggedRoot}/"
                            >${t.rebloggedRoot}</a
                        >
                    </div>
                </div>
                <div class="nowrap" ?hidden=${!t.reblogged||t.rebloggedRoot===t.reblogged}>
                    <i class="fas fa-share-square"></i>&nbsp;<a href="/folder/${t.reblogged}/">${t.reblogged}</a>
                </div>
            </div>
        `}setLoading(t){this.$end.classList[t?"add":"remove"]("loading")}render(t){t.length||t.push({url:"",idx:1/0,photoset:[],photos:[{thumb:"/imgs/notfound.png",hres:"/img/notfound.png"}]}),t.forEach((t=>{const e=document.createElement("div");e.classList.add("post");const i=this.minColIdx,s=this.renderPost(t,{handleEvent:t=>{this.downloadDirect(t.target.dataset.src||"")}},i);((t,e)=>{const i=(void 0,e);let s=i._$litPart$;if(void 0===s){const t=(void 0,null);i._$litPart$=s=new S(e.insertBefore(l(),t),t,void 0,{})}s._$AI(t)})(s,e),this.state.colh[i]+=300,console.log("Appendind to ",i),this.$cols[i].append(e),e.querySelectorAll("img").forEach((t=>{t.onload=()=>{this.state.colh[i]=this.state.colh[i]-300+t.clientHeight,t.onload=null}}))}))}async loadNext(){this.setLoading(!0);try{const t=await fetch("/items/"+it.ACCOUNT+"/"+this.state.offset+(window.location.search||"")).then((t=>t.json()));this.render(t.items)}catch(t){console.log("err",t),alert(t)}finally{this.setLoading(!1)}this.state.offset+=it.PAGE_SIZE,window.location.hash=String(this.state.offset)}recordTimer(){this.$timer.secs.innerText=String(this.state.timerSec/1e3)}swap(t,e=1){1===e?(t.setAttribute("data-thumb",t.src),t.src=t.dataset.orig||t.src):(t.setAttribute("data-orig",t.src),t.src=t.dataset.thumb||t.src)}select(t){const e=document.querySelector(".big");e&&(e.classList.remove("big"),this.swap(e,-1)),t?(this.swap(t,1),t.classList.add("big"),this.$timer.$.style.display="block"):this.$timer.$.style.display="none"}}return it.PAGE_SIZE=__DATA__.pageSize,it.API_URL=__DATA__.apiUrl,it.ACCOUNT=__DATA__.account,new it}();
